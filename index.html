<script type="module">
    // استيراد Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // إعداد Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBaHujfhSY-Hd_u-CzsAqIfZ9eGMree4Oo",
        authDomain: "mychessgame-7811e.firebaseapp.com",
        databaseURL: "https://mychessgame-7811e-default-rtdb.firebaseio.com",
        projectId: "mychessgame-7811e",
        storageBucket: "mychessgame-7811e.appspot.com",
        messagingSenderId: "512952991572",
        appId: "your_app_id"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.onload = function() {
        // التأكد من جاهزية Web App
        window.Telegram.WebApp.ready();
        const user = window.Telegram.WebApp.initDataUnsafe.user;

        // تحديث اسم المستخدم في HTML
        if (user) {
            document.getElementById("username").textContent = user.username;
            
            // جلب النقاط من Firebase
            const userRef = ref(db, 'users/' + user.id);
            get(userRef).then((snapshot) => {
                if (snapshot.exists()) {
                    document.getElementById("score").textContent = snapshot.val().points;
                } else {
                    document.getElementById("score").textContent = "0";
                }
            }).catch((error) => {
                console.error("Error fetching data: ", error);
                document.getElementById("score").textContent = "خطأ في جلب البيانات";
            });
        } else {
            document.getElementById("username").textContent = "مستخدم مجهول";
            document.getElementById("score").textContent = "غير متاح";
        }
    };
</script>
